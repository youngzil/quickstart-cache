#docker-compose -f docker-compose-cluster.yml up -d

#这里yml中的node1~node6没有实际意义,具体的主从分配是redis决定的.

version: '3'

services:
  node1:
    image: redis
    container_name: redis-cluster-node1
    command: /bin/bash -c "redis-server /etc/redis/redis.conf"
    volumes:
      - /usr/local/etc/docker-compose/redis-cluster/cluster1/master:/etc/redis
      - /usr/local/etc/docker-compose/redis-cluster/cluster1/master:/data
      - /usr/local/etc/docker-compose/redis-cluster/cluster1/master:/log
    ports:
      - 6379:6379
    networks:
      redisNet:
        ipv4_address: 192.168.88.80

  node2:
    image: redis
    container_name: redis-cluster-node2
    command: /bin/bash -c "redis-server /etc/redis/redis.conf"
    volumes:
      - /usr/local/etc/docker-compose/redis-cluster/cluster1/follower:/etc/redis
      - /usr/local/etc/docker-compose/redis-cluster/cluster1/follower:/data
      - /usr/local/etc/docker-compose/redis-cluster/cluster1/follower:/log
    ports:
      - 6380:6379
    networks:
      redisNet:
        ipv4_address: 192.168.88.81

  node3:
    image: redis
    container_name: redis-cluster-node3
    command: /bin/bash -c "redis-server /etc/redis/redis.conf"
    volumes:
      - /usr/local/etc/docker-compose/redis-cluster/cluster2/master:/etc/redis
      - /usr/local/etc/docker-compose/redis-cluster/cluster2/master:/data
      - /usr/local/etc/docker-compose/redis-cluster/cluster2/master:/log
    ports:
      - 6381:6379
    networks:
      redisNet:
        ipv4_address: 192.168.88.82

  node4:
    image: redis
    container_name: redis-cluster-node4
    command: /bin/bash -c "redis-server /etc/redis/redis.conf"
    volumes:
      - /usr/local/etc/docker-compose/redis-cluster/cluster2/follower:/etc/redis
      - /usr/local/etc/docker-compose/redis-cluster/cluster2/follower:/data
      - /usr/local/etc/docker-compose/redis-cluster/cluster2/follower:/log
    ports:
      - 6382:6379
    networks:
      redisNet:
        ipv4_address: 192.168.88.83

  node5:
    image: redis
    container_name: redis-cluster-node5
    command: /bin/bash -c "redis-server /etc/redis/redis.conf"
    volumes:
      - /usr/local/etc/docker-compose/redis-cluster/cluster3/master:/etc/redis
      - /usr/local/etc/docker-compose/redis-cluster/cluster3/master:/data
      - /usr/local/etc/docker-compose/redis-cluster/cluster3/master:/log
    ports:
      - 6383:6379
    networks:
      redisNet:
        ipv4_address: 192.168.88.84

  node6:
    image: redis
    container_name: redis-cluster-node6
    command: /bin/bash -c "redis-server /etc/redis/redis.conf"
    volumes:
      - /usr/local/etc/docker-compose/redis-cluster/cluster3/follower:/etc/redis
      - /usr/local/etc/docker-compose/redis-cluster/cluster3/follower:/data
      - /usr/local/etc/docker-compose/redis-cluster/cluster3/follower:/log
    ports:
      - 6384:6379
    networks:
      redisNet:
        ipv4_address: 192.168.88.85

networks:
  redisNet:
    external: true

